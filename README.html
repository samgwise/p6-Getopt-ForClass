<!doctype html>
<html lang="en">
<head>
  <title></title>
  <meta charset="UTF-8" />
  <style>
    /* code gets the browser-default font
     * kbd gets a slightly less common monospace font
     * samp gets the hard pixelly fonts
     */
    kbd { font-family: "Droid Sans Mono", "Luxi Mono", "Inconsolata", monospace }
    samp { font-family: "Terminus", "Courier", "Lucida Console", monospace }
    /* WHATWG HTML frowns on the use of <u> because it looks like a link,
     * so we make it not look like one.
     */
    u { text-decoration: none }
    .nested {
        margin-left: 3em;
    }
    // footnote things:
    aside, u { opacity: 0.7 }
    a[id^="fn-"]:target { background: #ff0 }
  </style>
  <link rel="stylesheet" href="//design.perl6.org/perl.css">
  <meta name="description" value="This module exports a function, build-main-for-class, which takes a class type and uses it to setup a MAIN function that is able to execut the various methods of that class as sub-commands of the script." />
  
</head>
<body class="pod" id="___top">


<nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
       <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#METHODS">METHODS</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.1</td><td class="toc-text"><a href="#sub_build-main-for-class">sub build-main-for-class</a></td></tr>
                                     <tr class="toc-level-2"><td class="toc-number">1.2</td><td class="toc-text"><a href="#sub_MAIN_HELPER">sub MAIN_HELPER</a></td></tr>
                              <tr class="toc-level-1"><td class="toc-number">2</td><td class="toc-text"><a href="#AUTHOR">AUTHOR</a></td></tr>
    <tr class="toc-level-1"><td class="toc-number">3</td><td class="toc-text"><a href="#COPYRIGHT_&amp;_LICENSE">COPYRIGHT & LICENSE</a></td></tr>
  
</table>
</nav>

<div class="pod-body

">
<section><h1>NAME</h1>
<p>Getopt::ForClass - Use MAIN to dispatch to a class</p>
</section>
<section><h1>SYNOPSIS</h1>
<pre class="pod-block-code">#!/usr/bin/env perl6
use Getopt::ForClass;

class MyApp {
    has $.token;

    method BUILD(:$!token) { }

    method list-things(:$filter) { ... }
    method add-thing($name) { ... }
    method remove-thing($name, Bool :$cascade) { ... }
}

our &amp;MAIN := build-main-for-class(
    class =&gt; MyApp,
);

# On the command-line:
# % myapp --token=abc123 list-things --filter red
# % myapp --token=abc123 add-thing socks
# % myapp --token=abc123 remove-thing shrubbery --cascade</pre>
</section>
<section><h1>DESCRIPTION</h1>
<p>This module exports a function, <code>build-main-for-class</code>, which takes a class type and uses it to setup a <code>MAIN</code> function that is able to execut the various methods of that class as sub-commands of the script.</p>
</section>
<h1 id="METHODS"><a class="u" href="#___top" title="go to top of document">METHODS</a></h1>
<h2 id="sub_build-main-for-class"><a class="u" href="#___top" title="go to top of document">sub build-main-for-class</a></h2>
<pre class="pod-block-code">sub build-main-for-class(:$class!, :$methods = *) returns Routine:D</pre>
<p>This routine is exported by default. Given a <code>$class</code>, it will inspect that class and generate a <code>MAIN</code> function that is able to execute one of the methods of that class per run. It does this by generating a multisub, which may be assigned to <code>MAIN</code> in your program.</p>
<p>Specifically, it does the following:</p>
<ul><li><p>1. One <code>MAIN</code> multisub candidate is generated for each method in the class (limited by the smartmatch in <code>$methods</code>, see below).</p>
</li>
<li><p>2. Each <code>MAIN</code> candidate will provide command-line options based upon the <code>BUILD</code> submethod for the class. If no <code>BUILD</code> is provided, then no attributes will be set during construction.</p>
</li>
<li><p>3. The first positional argument accepted by each <code>MAIN</code> candidate is the name of one of the methods in the class.</p>
</li>
<li><p>4. The remaining positional and named arguments for each <code>MAIN</code> candidate are those taken from <code>BUILD</code> and those taken from the method of the class this candidate is associated with.</p>
</li>
</ul>
<p>When run, the <code>MAIN</code> method will first construct an object by calling the <code>new</code> method and passing to that method the same parameters as are defined in <code>BUILD</code>. It will then call the method for the selected candidate passing to that method all the arguments given on the command-line.</p>
<h2 id="sub_MAIN_HELPER"><a class="u" href="#___top" title="go to top of document">sub MAIN_HELPER</a></h2>
<pre class="pod-block-code">sub MAIN_HELPER($retval = 0)</pre>
<p>In addition to generating the <code>MAIN</code> routine, this module also provides a <code>MAIN_HELPER</code>, which will parse the command-line arguments to call the generated <code>MAIN</code> subroutine.</p>
<p>This implementation will attempt to locate the most appropriate <code>MAIN</code> candidate using parameters given on the command-line. It will then organize and pass the command-line parameters to the <code>MAIN</code> candidate. This works somewhat differently from the Perl6 native <code>MAIN_HELPER</code> (at least as of this writing):</p>
<ul><li><p>* Any parameter of the form <code>--NAME=VALUE</code> will be treated as a named parameter. If the candidate explicitly defines that named parameter with a numeric type, the value will be converted to a number before being passed. If it defines a boolean type, the value will be converted to False if it matches &quot;1&quot;, &quot;y&quot;, &quot;yes&quot;, or &quot;true&quot; (using a case insensitive match) and True otherwise. Otherwise, the string will be passed as is.</p>
</li>
<li><p>* Any parameter of the form <code>--NAME</code> will be treated as a named parameter. If the candidate explicityly defines that named parameter as boolean, it will be set to a True value. Any other type is assumed to require a parameter so the next argument on the command-line must be a parameter. If the type of the named parameter is numeric, the value will be coerced into a number before being passed.</p>
</li>
<li><p>* Any parameter of the form <code>--no-NAME</code> will be treated as a named parameter. The named parameter will be set to False.</p>
</li>
<li><p>* Any parameter following <code>--</code> will be treated as a positional parameter, even if it takes on one of the forms named above.</p>
</li>
<li><p>* Any other parameter is treated as a positional parameter. Positional parameters will be converted to boolean or numbers based upon type.</p>
</li>
</ul>
<p>This implementation is less picky about the ordering of parameters than the built-in Perl 6 implementation that is in place as of this writing.</p>
<h1 id="AUTHOR"><a class="u" href="#___top" title="go to top of document">AUTHOR</a></h1>
<p>Sterling Hanenkamp <code>&lt;hanenkamp@cpan.org&gt; </code></p>
<h1 id="COPYRIGHT_&_LICENSE"><a class="u" href="#___top" title="go to top of document">COPYRIGHT &amp; LICENSE</a></h1>
<p>Copyright 2016 Sterling Hanenkamp.</p>
<p>This software is licensed under the same terms as Perl 6.</p>

</div>


</body>
</html>

